name: CI

on:
  push:
    branches:
      - develop

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      DATABASE_URL: ${{ secrets.DATABASE_URL_STAGING }}

    steps:
      - name: Checkout code ‚úîÔ∏è
        uses: actions/checkout@v3

      - name: Set up PHP ‚öôÔ∏è
        uses: shivammathur/setup-php@2.28.0
        with:
          php-version: '8.2'

      - name: Install dependencies üî®
        run: composer install --ignore-platform-reqs
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL_STAGING }}

      - name: Lint PHP files üëï
        uses: overtrue/phplint@main
        with:
          path: .
          options: --exclude=vendor

      - name: Run unit tests ‚úÖ
        run: php bin/phpunit
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL_STAGING }}